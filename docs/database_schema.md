# Database Schema for Blog Posts

<!-- TODO: Kjør SQL-koden under i Supabase SQL Editor for å opprette `posts`-tabellen og sette opp Row Level Security. -->

## Table: `posts`

```sql
-- Oppretter tabellen for å lagre blogginnlegg
CREATE TABLE public.posts (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  title text NOT NULL,
  slug text NOT NULL UNIQUE,
  content text,
  user_id uuid NOT NULL DEFAULT auth.uid(),
  CONSTRAINT posts_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users (id) ON DELETE CASCADE
);

-- Legger til kommentarer for klarhet
COMMENT ON TABLE public.posts IS 'Blog posts written by users.';
```

## Row Level Security (RLS)

```sql
-- 1. Aktiver RLS på den nye tabellen
ALTER TABLE public.posts ENABLE ROW LEVEL SECURITY;

-- 2. Policy: Tillat offentlig lesetilgang for alle
CREATE POLICY "Allow public read access"
ON public.posts
FOR SELECT
USING (true);

-- 3. Policy: Tillat brukere å sette inn egne innlegg
CREATE POLICY "Allow authenticated users to insert"
ON public.posts
FOR INSERT
WITH CHECK (auth.role() = 'authenticated');

-- 4. Policy: Tillat brukere å oppdatere sine egne innlegg
CREATE POLICY "Allow users to update their own posts"
ON public.posts
FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

-- 5. Policy: Tillat brukere å slette sine egne innlegg
CREATE POLICY "Allow users to delete their own posts"
ON public.posts
FOR DELETE
USING (auth.uid() = user_id);
```
